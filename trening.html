<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>–¢—Ä–µ–Ω–∏–Ω–≥ - –°–ª–æ–≤–æ –ø–æ —Å–ª–æ–≤–æ</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@latest/dist/speech-commands.min.js"></script>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); text-align: center; padding: 20px; }
        .card { background: white; max-width: 800px; margin: auto; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 10px; margin: 20px 0; }
        .tile { padding: 10px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .tile.active { background: var(--primary); color: white; }
        .tile.done { border-color: var(--success); border-width: 2px; }
        .btn { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; margin: 5px; }
        .btn-rec { background: var(--primary); width: 100%; font-size: 1.2rem; }
        .btn-train { background: var(--success); }
        .btn-save { background: #f39c12; }
        #test-area { margin-top: 20px; padding: 15px; border: 2px dashed #3498db; border-radius: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h1>üéôÔ∏è –¢—Ä–µ–Ω–∏–Ω–≥ —Ü–µ–Ω—Ç–∞—Ä</h1>
    <p>–ò–∑–∞–±–µ—Ä–∏ —Å–ª–æ–≤–æ –∏ –¥—Ä–∂–∏ –¥—É–≥–º–µ –¥–æ–∫ –∏–∑–≥–æ–≤–∞—Ä–∞—à. –°–Ω–∏–º–∏ –±–∞—Ä–µ–º 5-8 –ø—Ä–∏–º–µ—Ä–∞ –ø–æ —Å–ª–æ–≤—É.</p>
    
    <button class="btn btn-save" onclick="recordNoise()">1. –°–Ω–∏–º–∏ —Ç–∏—à–∏–Ω—É (5x)</button>
    <div class="grid" id="alphabet-grid"></div>
    
    <h2 id="current-label">–û–¥–∞–±–µ—Ä–∏ —Å–ª–æ–≤–æ –∏–∑–Ω–∞–¥</h2>
    <button id="rec-btn" class="btn btn-rec" disabled>–î–†–ñ–ò –ó–ê –°–ù–ò–ú–ê–ä–ï</button>
    
    <hr>
    
    <button class="btn btn-train" onclick="train()">2. –ü–æ–∫—Ä–µ–Ω–∏ —Ç—Ä–µ–Ω–∏–Ω–≥</button>
    
    <div id="test-area">
        <h3>3. –¢–µ—Å—Ç –ø—Ä–µ—Ü–∏–∑–Ω–æ—Å—Ç–∏</h3>
        <button class="btn btn-rec" style="width: auto;" onclick="toggleTesting()">–ü–æ—á–Ω–∏/–ó–∞—É—Å—Ç–∞–≤–∏ —Ç–µ—Å—Ç</button>
        <div id="test-result" style="font-size: 1.5rem; margin-top: 10px; font-weight: bold;">-</div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-save" onclick="saveToBrowser()">üíæ –°–ê–ß–£–í–ê–à –ú–û–î–ï–õ –ó–ê –ò–ì–†–£</button>
        <a href="index.html" style="display: block; margin-top: 10px;">–ò–¥–∏ –Ω–∞ –ø–æ—á–µ—Ç–Ω—É / –ò–≥—Ä—É</a>
    </div>
</div>

<script>
    const azbuka = "–ê–ë–í–ì–î–Ç–ï–ñ–ó–ò–à–ö–õ–â–ú–ù–ä–û–ü–†–°–¢–ã–£–§–•–¶–ß–è–®";
    let recognizer;
    let currentSlovo = null;
    let isTesting = false;

    async function init() {
        const base = speechCommands.create('BROWSER_FFT');
        await base.ensureModelLoaded();
        recognizer = base.createTransfer('moj-ai');
        
        const grid = document.getElementById('alphabet-grid');
        azbuka.split("").forEach(s => {
            const div = document.createElement('div');
            div.className = 'tile';
            div.innerText = s;
            div.onclick = () => {
                document.querySelectorAll('.tile').forEach(t => t.classList.remove('active'));
                div.classList.add('active');
                currentSlovo = s;
                document.getElementById('current-label').innerText = `–°–Ω–∏–º–∞–º–æ: ${s}`;
                document.getElementById('rec-btn').disabled = false;
            };
            grid.appendChild(div);
        });
    }

    async function recordNoise() {
        for(let i=0; i<5; i++) await recognizer.collectExample('_background_noise_');
        alert("–¢–∏—à–∏–Ω–∞ —Å–Ω–∏–º—ô–µ–Ω–∞!");
    }

    const recBtn = document.getElementById('rec-btn');
    recBtn.onmousedown = async () => {
        if(!currentSlovo) return;
        await recognizer.collectExample(currentSlovo);
        recBtn.style.background = "red";
    };
    recBtn.onmouseup = () => recBtn.style.background = "";

    async function train() {
        document.body.style.opacity = "0.5";
        await recognizer.train({ epochs: 30 });
        document.body.style.opacity = "1";
        alert("–¢—Ä–µ–Ω–∏–Ω–≥ –≥–æ—Ç–æ–≤! –ú–æ–∂–µ—à —Ç–µ—Å—Ç–∏—Ä–∞—Ç–∏.");
    }

    async function toggleTesting() {
        if(isTesting) {
            recognizer.stopListening();
            document.getElementById('test-result').innerText = "-";
        } else {
            await recognizer.listen(res => {
                const idx = res.scores.indexOf(Math.max(...res.scores));
                document.getElementById('test-result').innerText = `${recognizer.wordLabels()[idx]} (${(res.scores[idx]*100).toFixed(0)}%)`;
            }, { probabilityThreshold: 0.70 });
        }
        isTesting = !isTesting;
    }

    async function saveToBrowser() {
        await recognizer.save('indexeddb://slovo-po-slovo-model');
        alert("–ú–æ–¥–µ–ª —ò–µ —Å–∞—á—É–≤–∞–Ω! –°–∞–¥–∞ –º–æ–∂–µ—à –∏—õ–∏ –Ω–∞ –ø–æ—á–µ—Ç–Ω—É —Å—Ç—Ä–∞–Ω—É –∏ –ø–æ—á–µ—Ç–∏ –∏–≥—Ä—É.");
    }

    init();
</script>
</body>
</html>