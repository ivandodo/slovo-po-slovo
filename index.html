<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>–ò–≥—Ä–∞ - –°–ª–æ–≤–æ –ø–æ —Å–ª–æ–≤–æ</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@latest/dist/speech-commands.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; color: white; text-align: center; padding: 50px; }
        .game-container { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; max-width: 600px; margin: auto; }
        #word-display { font-size: 4rem; letter-spacing: 15px; margin: 30px 0; font-family: monospace; }
        .hidden { display: none; }
        .btn { padding: 15px 30px; border: none; border-radius: 30px; cursor: pointer; font-size: 1.2rem; font-weight: bold; background: #27ae60; color: white; }
    </style>
</head>
<body>

<div id="setup-screen" class="game-container">
    <h1>–î–æ–±—Ä–æ–¥–æ—à–ª–∏ —É "–°–ª–æ–≤–æ –ø–æ —Å–ª–æ–≤–æ"</h1>
    <p>–î–∞ –±–∏—Å—Ç–µ –ø–æ—á–µ–ª–∏, –º–æ—Ä–∞—Ç–µ —É—á–∏—Ç–∞—Ç–∏ –≤–∞—à –∏—Å—Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏ –º–æ–¥–µ–ª.</p>
    <button class="btn" onclick="loadAndStart()">üîÑ –£–ß–ò–¢–ê–à –ú–û–î–ï–õ –ò –ü–û–ß–ù–ò</button>
    <br><br>
    <a href="trening.html" style="color: #ecf0f1;">–ù–µ–º–∞—à –º–æ–¥–µ–ª? –ò–¥–∏ –Ω–∞ —Ç—Ä–µ–Ω–∏–Ω–≥</a>
</div>

<div id="game-screen" class="game-container hidden">
    <h2 id="status">–°–ª—É—à–∞–º... –∏–∑–≥–æ–≤–æ—Ä–∏ —Å–ª–æ–≤–æ</h2>
    <div id="word-display">_ _ _ _ _</div>
    <div id="alphabet-status" style="font-size: 0.8rem; color: #bdc3c7;"></div>
</div>

<script>
    const azbuka = "–ê–ë–í–ì–î–Ç–ï–ñ–ó–ò–à–ö–õ–â–ú–ù–ä–û–ü–†–°–¢–ã–£–§–•–¶–ß–è–®";
    const pojmovi = ["–ü–†–û–ì–†–ê–ú–ò–†–ê–ä–ï", "–ë–ï–û–ì–†–ê–î", "–¢–ï–ù–°–û–†–§–õ–û–£", "–°–õ–ê–ì–ê–õ–ò–¶–ê"];
    let recognizer;
    let target = "";
    let guessed = [];

    async function loadAndStart() {
        try {
            const base = speechCommands.create('BROWSER_FFT');
            await base.ensureModelLoaded();
            recognizer = base.createTransfer('igra-model');
            
            // Uƒçitavanje iz IndexedDB
            await recognizer.load('indexeddb://slovo-po-slovo-model');
            
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            startGame();
        } catch (e) {
            alert("–ù–∏—Å–∞–º –Ω–∞—à–∞–æ —Å–∞—á—É–≤–∞–Ω –º–æ–¥–µ–ª. –ò–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞ —Ç—Ä–µ–Ω–∏–Ω–≥.");
        }
    }

    function startGame() {
        target = pojmovi[Math.floor(Math.random()*pojmovi.length)];
        guessed = [];
        render();
        startListening();
    }

    function render() {
        let out = "";
        for(let s of target) {
            out += (guessed.includes(s) ? s : "_");
        }
        document.getElementById('word-display').innerText = out;
        if(!out.includes("_")) {
            document.getElementById('status').innerText = "–ü–û–ë–ï–î–ê!";
            recognizer.stopListening();
        }
    }

    async function startListening() {
        await recognizer.listen(res => {
            const scores = Array.from(res.scores);
            const idx = scores.indexOf(Math.max(...scores));
            const slovo = recognizer.wordLabels()[idx];
            
            if(res.scores[idx] > 0.85 && azbuka.includes(slovo)) {
                if(!guessed.includes(slovo)) {
                    guessed.push(slovo);
                    render();
                    document.getElementById('status').innerText = `–ß—É–æ —Å–∞–º: ${slovo}`;
                }
            }
        }, { probabilityThreshold: 0.75 });
    }
</script>
</body>
</html>